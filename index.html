<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spaceflight News</title>
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <form class="form" action="">
      <label>Spaceflight articles</label>
      <input type="text" class="nb-news-input" />
    </form>

    <div class="container">
      <div class="news-list"></div>
    </div>

    <div class="loading">
      <div class="ball"></div>
      <div class="ball"></div>
      <div class="ball"></div>
    </div>

    <script>
      const userInput = document.querySelector('.nb-news-input');
      const newsList = document.querySelector('.news-list');

      const loading = document.querySelector('.loading');
      userInput.addEventListener('change', loadNews);

      window.addEventListener('scroll', () => {
        const { scrollTop, scrollHeight, clientHeight } =
          document.documentElement;

        if (clientHeight + scrollTop >= scrollHeight) {
          showLoading();
        }
      });
      function showLoading() {
        loading.classList.add('show');
        setTimeout(loadNews, 1000);
      }

      function loadNews(e) {
        let newsNumber = userInput.value;

        let url = `https://api.spaceflightnewsapi.net/v3/articles?_limit=${newsNumber}`;

        fetch(url)
          .then((response) => {
            return response.json();
          })
          .then((data) => {
            data.forEach((news) => {
              let newsTitle = document.createElement('h2');
              let summaryField = document.createElement('p');
              let link = document.createElement('a');

              link.textContent = 'Read more';
              link.setAttribute('href', news.url);
              link.setAttribute('target', '_blank');
              newsTitle.textContent = news.title;

              if (news.summary.length - 200 <= 0) {
                summaryField.textContent = news.summary + ' ...';
              } else {
                summaryField.textContent =
                  news.summary.substring(0, 200) + ' ...';
              }

              newsList.appendChild(newsTitle);
              newsList.appendChild(summaryField);
              newsList.appendChild(link);
              loading.classList.remove('show');
            });
          })
          .catch((error) => {
            console.log(error);
          });
      }
      loadNews();
    </script>
  </body>
</html>
